(self.webpackChunk_collaborne_remirror_entity_extension=self.webpackChunk_collaborne_remirror_entity_extension||[]).push([[179],{"./.storybook/stories sync recursive ^\\.(?:(?:^%7C\\/%7C(?:(?:(?%21(?:^%7C\\/)\\.).)*?)\\/)(?%21\\.)(?=.)[^/]*?\\.stories\\.tsx)$":(module,__unused_webpack_exports,__webpack_require__)=>{var map={"./entity-extension.stories.tsx":"./.storybook/stories/entity-extension.stories.tsx"};function webpackContext(req){var id=webpackContextResolve(req);return __webpack_require__(id)}function webpackContextResolve(req){if(!__webpack_require__.o(map,req)){var e=new Error("Cannot find module '"+req+"'");throw e.code="MODULE_NOT_FOUND",e}return map[req]}webpackContext.keys=function webpackContextKeys(){return Object.keys(map)},webpackContext.resolve=webpackContextResolve,module.exports=webpackContext,webpackContext.id="./.storybook/stories sync recursive ^\\.(?:(?:^%7C\\/%7C(?:(?:(?%21(?:^%7C\\/)\\.).)*?)\\/)(?%21\\.)(?=.)[^/]*?\\.stories\\.tsx)$"},"./.storybook/stories/entity-extension.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Basic:()=>Basic,__namedExportsOrder:()=>__namedExportsOrder,default:()=>entity_extension_stories});var objectSpread2=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/objectSpread2.js"),remirror_react_core=__webpack_require__("./node_modules/@remirror/react-core/dist/remirror-react-core.js"),remirror_core_helpers=__webpack_require__("./node_modules/@remirror/core-helpers/dist/remirror-core-helpers.js"),defineProperty=(__webpack_require__("./node_modules/remirror/styles/all.css"),__webpack_require__("./node_modules/@babel/runtime/helpers/esm/defineProperty.js")),objectWithoutProperties=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js"),classCallCheck=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),createClass=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/createClass.js"),assertThisInitialized=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js"),inherits=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/inherits.js"),createSuper=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/createSuper.js"),applyDecoratedDescriptor=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/applyDecoratedDescriptor.js"),toConsumableArray=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/toConsumableArray.js"),remirror_core=__webpack_require__("./node_modules/@remirror/core/dist/remirror-core.js"),remirror_core_constants=__webpack_require__("./node_modules/@remirror/core-constants/dist/remirror-core-constants.js"),remirror_core_utils=__webpack_require__("./node_modules/@remirror/core-utils/dist/remirror-core-utils.js"),react=__webpack_require__("./node_modules/react/index.js"),jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js");function EntityComponent(_ref){var entity=_ref.entity,uniqueEntities=_ref.uniqueEntities,upsertEntity=_ref.upsertEntity,items=(0,react.useMemo)((function(){return uniqueEntities.map((function(_ref2){return{id:_ref2.id,name:_ref2.name}}))}),[uniqueEntities]),addEntity=(0,react.useCallback)((function(){var id=(0,remirror_core_helpers.EL)();upsertEntity({id,name:id})}),[upsertEntity]),handleSelectEntity=(0,react.useCallback)((function(event){var entityId=event.target.value;if("add"===entityId)return addEntity();var selectedEntity=uniqueEntities.find((function(entity){return entity.id===entityId}));selectedEntity&&upsertEntity({id:selectedEntity.id,name:selectedEntity.name})}),[uniqueEntities,addEntity,upsertEntity]);return 0===items.length?null:(0,jsx_runtime.jsxs)("select",{value:entity.id,onChange:handleSelectEntity,children:[items.map((function(item){return(0,jsx_runtime.jsx)("option",{value:item.id,children:item.name},item.id)})),(0,jsx_runtime.jsx)("option",{value:"add",children:"Add entity"},"add")]})}var defaultRenderEntity=function defaultRenderEntity(_ref3){var entity=_ref3.entity,uniqueEntities=_ref3.uniqueEntities,upsertEntity=_ref3.upsertEntity;return(0,jsx_runtime.jsx)(EntityComponent,{entity,uniqueEntities,upsertEntity})};try{EntityComponent.displayName="EntityComponent",EntityComponent.__docgenInfo={description:"",displayName:"EntityComponent",props:{entity:{defaultValue:null,description:"",name:"entity",required:!0,type:{name:"EntityAttrs"}},upsertEntity:{defaultValue:null,description:"",name:"upsertEntity",required:!0,type:{name:"(attrs: ProsemirrorAttributes<object>) => void"}},uniqueEntities:{defaultValue:null,description:"",name:"uniqueEntities",required:!0,type:{name:"EntityAttrs[]"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/default-render-component.tsx#EntityComponent"]={docgenInfo:EntityComponent.__docgenInfo,name:"EntityComponent",path:"src/default-render-component.tsx#EntityComponent"})}catch(__react_docgen_typescript_loader_error){}try{defaultRenderEntity.displayName="defaultRenderEntity",defaultRenderEntity.__docgenInfo={description:"",displayName:"defaultRenderEntity",props:{entity:{defaultValue:null,description:"",name:"entity",required:!0,type:{name:"EntityAttrs"}},upsertEntity:{defaultValue:null,description:"",name:"upsertEntity",required:!0,type:{name:"(attrs: ProsemirrorAttributes<object>) => void"}},uniqueEntities:{defaultValue:null,description:"",name:"uniqueEntities",required:!0,type:{name:"EntityAttrs[]"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/default-render-component.tsx#defaultRenderEntity"]={docgenInfo:defaultRenderEntity.__docgenInfo,name:"defaultRenderEntity",path:"src/default-render-component.tsx#defaultRenderEntity"})}catch(__react_docgen_typescript_loader_error){}function hash(val){return JSON.stringify(val)}var _dec,_dec2,_dec3,_dec4,_dec5,_class,_class2,_excluded=["id","name"],getUniqueEntitiesFromPluginState=function getUniqueEntitiesFromPluginState(props){var extension=props.extension,state=props.state;return extension.getPluginState(state).uniqueEntities};function isSame(array,newArray){return hash(newArray)===hash(array)}function computeUniqueEntities(entities){var uniqueEntitiesById=new Map;return entities.forEach((function(_ref){var id=_ref.id,name=_ref.name;uniqueEntitiesById.set(id,{id,name})})),(0,toConsumableArray.Z)(uniqueEntitiesById.values())}var EntityExtension=(_dec=(0,remirror_core.AOx)({defaultOptions:{render:defaultRenderEntity}}),_dec2=(0,remirror_core._y)(),_dec3=(0,remirror_core._y)(),_dec4=(0,remirror_core.WDe)(),_dec5=(0,remirror_core.WDe)(),_dec((_class2=function(_NodeExtension){(0,inherits.Z)(EntityExtension,_NodeExtension);var _super=(0,createSuper.Z)(EntityExtension);function EntityExtension(){var _this;(0,classCallCheck.Z)(this,EntityExtension);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];return(_this=_super.call.apply(_super,[this].concat(args))).ReactComponent=function(_ref2){var node=_ref2.node,updateAttributes=_ref2.updateAttributes,renderEntity=_this.options.render,uniqueEntities=getUniqueEntitiesFromPluginState({extension:(0,assertThisInitialized.Z)(_this),state:_this.store.getState()});return renderEntity({entity:node.attrs,uniqueEntities,upsertEntity:updateAttributes})},_this}return(0,createClass.Z)(EntityExtension,[{key:"name",get:function get(){return"entity"}},{key:"createPlugin",value:function createPlugin(){var _this2=this;return{state:{init:function init(_,state){var entities=_this2.getAllEntitiesFromDoc(state.doc);return{entities,uniqueEntities:computeUniqueEntities(entities)}},apply:function apply(tr,oldEntityState,_oldState,newState){if(!tr.docChanged)return oldEntityState;var entities=_this2.getAllEntitiesFromDoc(newState.doc);if(isSame(entities,oldEntityState.entities))return oldEntityState;var uniqueEntities=computeUniqueEntities(entities);return isSame(uniqueEntities,oldEntityState.uniqueEntities)&&(uniqueEntities=oldEntityState.uniqueEntities),{entities,uniqueEntities}}}}}},{key:"createTags",value:function createTags(){return[remirror_core_constants.eX.InlineNode]}},{key:"createNodeSpec",value:function createNodeSpec(extra,override){var _override$parseDOM;return(0,objectSpread2.Z)((0,objectSpread2.Z)({attrs:(0,objectSpread2.Z)((0,objectSpread2.Z)({},extra.defaults()),{},{id:{default:null},name:{default:""}}),selectable:!0,draggable:!0,atom:!0,inline:!0,marks:""},override),{},{parseDOM:[{tag:"span[".concat("s-id","]"),getAttrs:function getAttrs(node){if(!(0,remirror_core_utils.jd)(node))return!1;var id=node.getAttribute("s-id"),name=node.getAttribute("s-name");return(0,objectSpread2.Z)((0,objectSpread2.Z)({},extra.parse(node)),{},{id,name})}}].concat((0,toConsumableArray.Z)(null!==(_override$parseDOM=override.parseDOM)&&void 0!==_override$parseDOM?_override$parseDOM:[])),toDOM:function toDOM(node){var _objectSpread2,_omitExtraAttributes=(0,remirror_core_utils.Kh)(node.attrs,extra),id=_omitExtraAttributes.id,name=_omitExtraAttributes.name,rest=(0,objectWithoutProperties.Z)(_omitExtraAttributes,_excluded);return["span",(0,objectSpread2.Z)((0,objectSpread2.Z)((0,objectSpread2.Z)({},extra.dom(node)),rest),{},(_objectSpread2={},(0,defineProperty.Z)(_objectSpread2,"s-id",id),(0,defineProperty.Z)(_objectSpread2,"s-name",name),_objectSpread2))]}})}},{key:"updateEntityByIdCommand",value:function updateEntityByIdCommand(id,update){var _this3=this;return function(_ref4){var tr=_ref4.tr,dispatch=_ref4.dispatch;return!dispatch||(tr.doc.descendants((function(node,pos){return node.type.name===_this3.name&&node.attrs.id===id&&tr.setNodeMarkup(pos,void 0,update),!0})),dispatch(tr),!0)}}},{key:"getAllEntitiesFromDoc",value:function getAllEntitiesFromDoc(doc){var _this4=this,parentNode=null!=doc?doc:this.store.getState().doc,entities=[];return parentNode.descendants((function(node){return node.type.name===_this4.name&&entities.push(node.attrs),!0})),entities}},{key:"getAllEntityNodesAttrs",value:function getAllEntityNodesAttrs(){return function getEntitiesFromPluginState(props){var extension=props.extension,state=props.state;return extension.getPluginState(state).entities}({extension:this,state:this.store.getState()})}},{key:"getUniqueEntities",value:function getUniqueEntities(){return getUniqueEntitiesFromPluginState({extension:this,state:this.store.getState()})}},{key:"createEntity",value:function createEntity(attributes){var _this5=this;return function(_ref5){var tr=_ref5.tr,dispatch=_ref5.dispatch,entity=_this5.type.create(attributes);return null==dispatch||dispatch(tr.replaceSelectionWith(entity)),!0}}},{key:"updateEntityById",value:function updateEntityById(id,attributes){return this.updateEntityByIdCommand(id,attributes)}}]),EntityExtension}(remirror_core.QR),(0,applyDecoratedDescriptor.Z)(_class2.prototype,"getAllEntityNodesAttrs",[_dec2],Object.getOwnPropertyDescriptor(_class2.prototype,"getAllEntityNodesAttrs"),_class2.prototype),(0,applyDecoratedDescriptor.Z)(_class2.prototype,"getUniqueEntities",[_dec3],Object.getOwnPropertyDescriptor(_class2.prototype,"getUniqueEntities"),_class2.prototype),(0,applyDecoratedDescriptor.Z)(_class2.prototype,"createEntity",[_dec4],Object.getOwnPropertyDescriptor(_class2.prototype,"createEntity"),_class2.prototype),(0,applyDecoratedDescriptor.Z)(_class2.prototype,"updateEntityById",[_dec5],Object.getOwnPropertyDescriptor(_class2.prototype,"updateEntityById"),_class2.prototype),_class=_class2))||_class);const entity_extension_stories={title:"Entity extension"};var Fruit;function fruit(fruit){return'<span s-id="'.concat(fruit,'" s-name="').concat(fruit,'"></span>')}!function(Fruit){Fruit.apple="Apple",Fruit.orange="Orange",Fruit.pear="Pear"}(Fruit||(Fruit={}));var CONTENT="\n<p>Hello ".concat(fruit(Fruit.apple),",</p>\n<p>Two other entities: ").concat(fruit(Fruit.orange),", ").concat(fruit(Fruit.pear),"</p>\n<p>And repeated: ").concat(fruit(Fruit.apple),", ").concat(fruit(Fruit.orange),", ").concat(fruit(Fruit.pear),"</p>\n<p></p>\n"),counter=1;function EditButton(_ref){var id=_ref.id,updateEntityById=(0,remirror_react_core.xd)().updateEntityById;return(0,jsx_runtime.jsxs)("button",{onClick:function handleClick(){updateEntityById(id,{id,name:"".concat(id," - ").concat(counter++)})},children:["Change ",id]})}function NewButton(){var createEntity=(0,remirror_react_core.xd)().createEntity;return(0,jsx_runtime.jsx)("button",{onClick:function handleClick(){var id=(0,remirror_core_helpers.EL)();createEntity({id,name:"New ".concat(id)})},children:"Add new"})}var Basic=function Basic(){var _useRemirror=(0,remirror_react_core.iF)({content:CONTENT,stringHandler:"html",extensions:function extensions(){return[new EntityExtension]}}),manager=_useRemirror.manager,state=_useRemirror.state;return(0,jsx_runtime.jsx)("div",{className:"remirror-theme",children:(0,jsx_runtime.jsxs)(remirror_react_core.O1,{manager,initialContent:state,children:[(0,jsx_runtime.jsx)(remirror_react_core.PG,{})," ",(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)(EditButton,{id:Fruit.apple})," ",(0,jsx_runtime.jsx)(EditButton,{id:Fruit.orange})," ",(0,jsx_runtime.jsx)(EditButton,{id:Fruit.pear})," ",(0,jsx_runtime.jsx)(NewButton,{})]})]})})};Basic.parameters=(0,objectSpread2.Z)({storySource:{source:"() => {\n\tconst { manager, state } = useRemirror({\n\t\tcontent: CONTENT,\n\t\tstringHandler: 'html',\n\t\textensions: () => [new EntityExtension()],\n\t});\n\n\treturn (\n\t\t<div className=\"remirror-theme\">\n\t\t\t<Remirror manager={manager} initialContent={state}>\n\t\t\t\t<EditorComponent />\n\t\t\t\t&nbsp;\n\t\t\t\t<div>\n\t\t\t\t\t<EditButton id={Fruit.apple} />\n\t\t\t\t\t&nbsp;\n\t\t\t\t\t<EditButton id={Fruit.orange} />\n\t\t\t\t\t&nbsp;\n\t\t\t\t\t<EditButton id={Fruit.pear} />\n\t\t\t\t\t&nbsp;\n\t\t\t\t\t<NewButton />\n\t\t\t\t</div>\n\t\t\t</Remirror>\n\t\t</div>\n\t);\n}"}},Basic.parameters);var __namedExportsOrder=["Basic"]},"./storybook-init-framework-entry.js":(__unused_webpack_module,__unused_webpack___webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__("./node_modules/@storybook/react/dist/esm/client/index.js")},"?4f7e":()=>{},"./generated-stories-entry.cjs":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";module=__webpack_require__.nmd(module),(0,__webpack_require__("./node_modules/@storybook/react/dist/esm/client/index.js").configure)([__webpack_require__("./.storybook/stories sync recursive ^\\.(?:(?:^%7C\\/%7C(?:(?:(?%21(?:^%7C\\/)\\.).)*?)\\/)(?%21\\.)(?=.)[^/]*?\\.stories\\.tsx)$")],module,!1)}},__webpack_require__=>{var __webpack_exec__=moduleId=>__webpack_require__(__webpack_require__.s=moduleId);__webpack_require__.O(0,[166],(()=>(__webpack_exec__("./node_modules/@storybook/core-client/dist/esm/globals/polyfills.js"),__webpack_exec__("./node_modules/@storybook/core-client/dist/esm/globals/globals.js"),__webpack_exec__("./storybook-init-framework-entry.js"),__webpack_exec__("./node_modules/@storybook/react/dist/esm/client/docs/config-generated-config-entry.js"),__webpack_exec__("./node_modules/@storybook/react/dist/esm/client/preview/config-generated-config-entry.js"),__webpack_exec__("./node_modules/@storybook/addon-actions/preview.js-generated-config-entry.js"),__webpack_exec__("./node_modules/@storybook/addon-docs/preview.js-generated-config-entry.js"),__webpack_exec__("./node_modules/@storybook/addon-links/preview.js-generated-config-entry.js"),__webpack_exec__("./generated-stories-entry.cjs"))));__webpack_require__.O()}]);